#!/usr/bin/env ruby

PROJECT_ROOT_PATH = File.absolute_path(File.join(__dir__, "."))
BUILD_PATH = File.join(PROJECT_ROOT_PATH, "tmp/builds")
COMPARISONS_REPO_ROOT_PATH = File.join(PROJECT_ROOT_PATH, "tmp/rails-template-variants-comparison")
ALL_BUILDS = Dir.children(BUILD_PATH)
VANILLA_BUILD_NAME = ALL_BUILDS.find { |build_name| build_name.start_with?("vanilla_") }
COMPARISON_BUILDS = ALL_BUILDS - [VANILLA_BUILD_NAME]

def main
  Dir.chdir(COMPARISONS_REPO_ROOT_PATH) do
    COMPARISON_BUILDS.each do |build_name|
      puts build_name
      # add --dry-run to test
      system("gh pr create --title 'Compare #{build_name} against vanilla Rails' --body 'Compare #{build_name} against vanilla Rails' --base main --head #{build_name}")
    end
  end
end

main
